require("./style.css");
require("./node_modules/bulma-pageloader/dist/css/bulma-pageloader.min.css");
var _CovidTs = require("./Covid.ts");
var _parcelHelpers = require("@parcel/transformer-js/lib/esmodule-helpers.js");
var _CovidTsDefault = _parcelHelpers.interopDefault(_CovidTs);
require("dotenv").config();
const progress = document.querySelector("#progress");
let cov = new _CovidTsDefault.default("https://services7.arcgis.com/mOBPykOjAyBO2ZKk/arcgis/rest/services/RKI_Landkreisdaten/FeatureServer/0/query?where=1%3D1&outFields=GEN,last_update,OBJECTID,BL_ID,BL,cases7_per_100k&returnGeometry=false&outSR=4326&f=json");
var ctx = document.getElementById("myChart").getContext("2d");
let _labels = [];
let _data = [];
let _color = [];
let _last_update = "";
let covData = cov.getData().then(i => {
  _last_update = " Aktualisierung: " + i.features[0].attributes.last_update;
  i.features.forEach(item => {
    if (item.attributes.BL_ID !== "5") return;
    if (item.attributes.cases7_per_100k > 100) {
      _color.push("rgb(255, 99, 132)");
    } else {
      _color.push("rgb(60, 179, 113)");
    }
    _data.push(item.attributes.cases7_per_100k.toFixed(1));
    _labels.push(item.attributes.GEN);
  });
  progress.classList.remove("is-active");
  var chart = new Chart(ctx, {
    type: "bar",
    data: {
      labels: _labels,
      datasets: [{
        label: ["FÃ¤lle letzte 7 Tage/100.000 EW - NRW ", _last_update],
        backgroundColor: _color,
        borderColor: "rgb(255, 99, 132)",
        data: _data
      }]
    },
    options: {
      plugins: {
        tooltip: {
          callbacks: {
            labelColor: function (context) {
              return {
                borderColor: "rgb(0, 0, 255)",
                backgroundColor: "rgb(255, 0, 0)",
                borderWidth: 2,
                borderDash: [2, 2],
                borderRadius: 2
              };
            },
            labelTextColor: function (context) {
              return "#543453";
            }
          }
        }
      }
    }
  });
});
